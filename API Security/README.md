# API Security

## Summary
- [Introduction](#introduction)
- [REST API](#rest-api)
- [RPC](#rpc)
- [SOAP](#soap)
- [GraphQL API](#graphql-api)

*Note: All image sources are from Bug Bounty Playbook v2*

## Introduction

In the past, applications were built with a single language, such as PHP, but today's application architecture tends to look a little different. Most modern applications are divided into two sections:

- Front-end
- Back-end

<img src="https://user-images.githubusercontent.com/43796175/122650971-70a28580-d0fb-11eb-8f1d-e935bc0a879d.jpg">

The application is divided into `Front-end` and` Back-end` code.

The `Front-end`, is the web user interface that you see in your browser, this is usually written in a modern JavaScript Framework like` ReactJS` or `AngularJS`.

The `Back-end` is the` API` and can be written in multiple languages:

<img src="https://user-images.githubusercontent.com/43796175/122651102-443b3900-d0fc-11eb-8ccb-56a5cd81ef83.jpg">

When it comes to these types of applications, there are certain things you need to know and become familiar with if you want to be successful.

There are several types of `API` and each one is slightly different, so before you start hacking the` API`, you need to understand a few things.

## REST API

If you notice that an application talks to a backend API 9/10 times, it will be a REST API.

An example Burp request to a REST API might look like the following image:

<img src="https://user-images.githubusercontent.com/43796175/122651291-78fbc000-d0fd-11eb-88ea-ed8485d3d149.jpg">

There are several ways to recognize a REST API:

- Looking at the request, the first sign that indicates that it is a request from a REST API is the fact that the request data is a JSON string. JSON strings are widely used by REST APIs.
- The other sign is that the application is sending a PUT request. The PUT method is one of several HTTP methods associated with REST APIs.
- Another sign that you are dealing with a REST API is when the HTTP response contains a MIME type of JSON.

<img src="https://user-images.githubusercontent.com/43796175/122651935-86b34480-d101-11eb-8532-1ed3026c34b6.jpg">


## RPC

The file `xmlrpc.php` indicates that there is an` RPC API`.

`XMLRPC` uses` XML`, while `JSONRPC` uses` JSON` for its encoding type.

If the endpoint was a `JSONRPC` API, the data would be contained in a` JSON` string instead of an `XML` document, that's really the only difference between the two
`RPC API`.

The `REST API` uses several HTTP methods, such as` PUT`, `POST` and` DELETE`, but the `RPC API` only uses two methods:
- `GET`
- `POST`

So if you see an HTTP request using something other than a `GET` or` POST` request, you know that it is probably not an RPC API.

## SOAP

<img src="https://user-images.githubusercontent.com/43796175/122705461-6677a880-d21b-11eb-9874-fe6a75168754.jpg">

As you can see, the message is first wrapped in a `<soapenv: Envelope>` tag that contains the header and body tags.

This value can be used as an indicator that this is a `SOAP API`, so keep an eye out for this string.

The `header` part is optional and is used to contain authentication-related values, complex types, and other information about the message itself.

The `body` is the part of the XML document that actually contains our message as shown below:

`` ''
<soapenv: Body>
  <web: GetCitiesByCountry>
    <! - type: string ->
    <web: CountryName> argentina </ web: CountryName>
  </ web: GetCitiesByCountry>
<soapenv: Body>
`` ''

As you can see in the SOAP `body` above, we are calling a method called` GetCitiesByCountry` and passing an argument called `CountryName` with a string value of` argentina`.


## GraphQL API

`GraphQL` is a data query language developed by Facebook and released in 2015.

`GraphQL` acts as an alternative to the` REST API`.

The `REST API` requires the client to send multiple requests to different` endpoints` in the `API` to query data from the` backend` database. With `graphQL`, you only need to send a request to query the` backend`.

This is a bit simpler because you don't have to send multiple requests to the `API`, a single request can be used to collect all the necessary information.

By default, `GraphQL` does not implement authentication, it must be done by the developer.

This means that, by default, `GraphQL` allows anyone to query sensitive information, and it will be available to unauthenticated attackers.

When fuzzing, look through these `endpoints` to find instances of` graphQL`:
`` ''
/ graphql
/ graphiql
/graphql.php
/ graphql / console
`` ''

Once you find an instance, you need to find out what queries it supports. You can find this out using the [Instrospection] system (https://graphql.org/learn/introspection/).

If you make the following request, it will show you all the queries that are available in the endpoint:
`` ''
https://vulnerable.com/graphql?query=[__schema[types separate}}}}
`` ''
<img src = "https://user-images.githubusercontent.com/43796175/122706194-fcf89980-d21c-11eb-9f34-36cb696edcff.jpg">

You can see that there is a `type` named` User` and it has two fields named `username` and` password`.

The `types` that start with` __example__` should be ignored, as they are part of a standard.

Once an interesting `type` is found, you can query its values ​​by issuing the following query:
`` ''
http://example.com/graphql?query={TYPE_1[FIELD_1,FIELD_2}}
`` ''

<img src = "https://user-images.githubusercontent.com/43796175/122706465-9de75480-d21d-11eb-8fba-40f8a1a1fa3c.jpg">

Once the query is submitted, you will get the relevant information and return the results to you. In this case, we get a set of credentials that can be used to access the application.

`GraphQL` is a relatively new technology that is starting to gain traction among startups and large corporations.

Apart from the vulnerability with the lack of default authentication, the `graphQL` endpoints can be vulnerable to other errors such as `IDOR`.


